package pages;

import java.time.Duration;

import org.openqa.selenium.JavascriptExecutor;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.interactions.Actions;
import org.openqa.selenium.support.FindBy;
import org.openqa.selenium.support.PageFactory;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;

public class BookDetailPage {

    private WebDriver driver;
    private WebDriverWait wait;

    @FindBy(xpath = "//a[@class='btn border themebackground text-white d-block mb-2' and @onclick='BuyNowProduct();']")
    private WebElement buyNowButton;

    public BookDetailPage(WebDriver driver) {
        this.driver = driver;
        this.wait = new WebDriverWait(driver, Duration.ofSeconds(15));
        PageFactory.initElements(driver, this);
    }

    public void clickBuyNow() {
        wait.until(ExpectedConditions.elementToBeClickable(buyNowButton));
        pause(1000);

        // Method 1: Normal click
        try {
            buyNowButton.click();
            test.info("Normal click worked");
            return;
        } catch (Exception e1) {
            test.info("Normal click failed, trying Actions...");
        }

        // Method 2: Actions class (moves mouse first)
        try {
            new Actions(driver)
                .moveToElement(buyNowButton)
                .pause(Duration.ofMillis(500))
                .click()
                .perform();
            test.info("Actions click worked");
            return;
        } catch (Exception e2) {
            test.info("Actions failed, trying JS...");
        }

        // Method 3: JavaScript click (bypasses overlays)
        ((JavascriptExecutor) driver).executeScript("arguments[0].click();", buyNowButton);
        test.info("JavaScript click executed");
        
        pause(2000);
    }

    private void pause(long millis) {
        try { Thread.sleep(millis); }
        catch (InterruptedException e) { Thread.currentThread().interrupt(); }
    }
}
